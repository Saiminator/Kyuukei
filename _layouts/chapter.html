---
layout: default
---
<article class="chapter-detail content-section">
  <h1>{{ page.title }}</h1>
  <div class="chapter-content">
    {{ content }}
  </div>
</article>

{% comment %}
  Filter and sort all chapters in the current segment.
{% endcomment %}
{% assign sorted = site.chapters | where:"segment", page.segment | sort:"chapter_number" %}
{% assign total = sorted | size %}

{% comment %}
  Loop through sorted chapters to find the current chapter's index
{% endcomment %}
{% assign current_index = 0 %}
{% for chap in sorted %}
  {% if chap.chapter_number | plus: 0 == page.chapter_number | plus: 0 %}
    {% assign current_index = forloop.index0 %}
  {% endif %}
{% endfor %}

{% comment %}
  Determine previous and next chapters only if they exist.
{% endcomment %}
{% if current_index == 0 %}
  {% assign previous_chapter = nil %}
{% else %}
  {% assign previous_chapter = sorted[current_index | minus: 1] %}
{% endif %}

{% if current_index == total | minus: 1 %}
  {% assign next_chapter = nil %}
{% else %}
  {% assign next_chapter = sorted[current_index | plus: 1] %}
{% endif %}

<nav class="chapter-nav">
  <div class="chapter-nav-container">
    {% if previous_chapter %}
      <a href="{{ previous_chapter.url | relative_url }}" class="nav-button">Previous Chapter</a>
    {% else %}
      <span class="nav-button disabled">Previous Chapter</span>
    {% endif %}
    <a href="{{ '/stories/' | append: page.segment | append: '/' | relative_url }}" class="nav-button">Back to Chapters</a>
    {% if next_chapter %}
      <a href="{{ next_chapter.url | relative_url }}" class="nav-button">Next Chapter</a>
    {% else %}
      <span class="nav-button disabled">Next Chapter</span>
    {% endif %}
  </div>
</nav>
