---
layout: default
title: Story Timeline
---

{%- comment -%}
  First, compute the container width dynamically.
  We assume a default chapter box width (e.g., 150px) plus each chapterâ€™s offset.
  Then we add an extra margin (e.g., 100px) to ensure enough space.
{%- endcomment -%}

{% assign containerWidth = 0 %}
{% assign chapterBoxWidth = 150 %}
{% assign extraMargin = 100 %}
{% assign timeline_names = "Kyuu|Cerulean Winds|Shimi|Dreymi|Via|Mika|Memo|Shizu" | split: "|" %}

{% for timeline in timeline_names %}
  {% assign timeline_chapters = site.chapters | where:"timeline", timeline | sort:"chapter_number" %}
  {% if timeline_chapters != empty %}
    {% assign timelineWidth = 0 %}
    {% for chapter in timeline_chapters %}
      {%- assign offset_val = chapter.offset | default: 10 | plus: 0 -%}
      {%- if offset_val == 0 or offset_val == "0" -%}
         {%- assign offset_val = 10 -%}
      {%- endif -%}
      {%- assign chapterRightEdge = offset_val | plus: chapterBoxWidth -%}
      {% if chapterRightEdge > timelineWidth %}
         {% assign timelineWidth = chapterRightEdge %}
      {% endif %}
    {% endfor %}
    {% if timelineWidth > containerWidth %}
         {% assign containerWidth = timelineWidth %}
    {% endif %}
  {% endif %}
{% endfor %}

{% assign finalWidth = containerWidth | plus: extraMargin %}

<section id="story" class="content-section">
  <h1>Story Timeline</h1>
  <div id="panZoomWrapper">
    <!-- Set the container width dynamically -->
    <div id="panZoomContainer" class="no-select" style="width:{{ finalWidth }}px;">
      {% for timeline in timeline_names %}
        {% assign timeline_chapters = site.chapters | where:"timeline", timeline | sort:"chapter_number" %}
        {% if timeline_chapters != empty %}
        <div class="timeline 
             {% if timeline == 'Kyuu' %}orby-pink{% elsif timeline == 'Cerulean Winds' %}cerulean{% elsif timeline == 'Shimi' %}shimi-green{% elsif timeline == 'Dreymi' %}dreymi{% elsif timeline == 'Via' %}via{% elsif timeline == 'Mika' %}mika{% elsif timeline == 'Memo' %}memo{% elsif timeline == 'Shizu' %}shizu{% endif %}">
          <h2>{{ timeline }}</h2>
          <div class="timeline-wrapper">
            <div class="chapter-container">
              {% for chapter in timeline_chapters %}
                {%- assign chapter_indent = chapter.offset | default: 10 -%}
                {%- if chapter_indent == 0 or chapter_indent == "0" -%}
                  {%- assign chapter_indent = 10 -%}
                {%- endif -%}
                <a href="{{ chapter.url }}" class="chapter-box" style="margin-left:{{ chapter_indent }}px;">
                  {{ chapter.chapter_title | default: "Chapter " | append: chapter.chapter_number }}
                </a>
              {% endfor %}
            </div>
            <div class="timeline-underline"></div>
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>
