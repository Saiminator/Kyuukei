---
layout: default
title: Character Wiki
---

<div id="character-page-wrapper">
  <!-- Sorting Tabs -->
  <div class="character-sort-tabs" style="text-align: center; margin-bottom: 20px;">
    <button id="popularity-tab" class="sort-tab active" style="padding: 10px 20px; margin: 0 5px;">Popularity</button>
    <button id="alphabetical-tab" class="sort-tab" style="padding: 10px 20px; margin: 0 5px;">Alphabetical</button>
    <button id="sorted-tab" class="sort-tab" style="padding: 10px 20px; margin: 0 5px;">Sorted</button>
  </div>

  <!-- Popularity View (Default) -->
  <div id="popularity-container" class="character-view-container">
    {% assign rankedSlugs = site.data.character_ranking | map: "slug" %}
    {% for entry in site.data.character_ranking %}
      {% assign found_character = nil %}
      {% for char in site.characters %}
        {% assign thisSlug = char.title | slugify %}
        {% if thisSlug == entry.slug %}
          {% assign found_character = char %}
        {% endif %}
      {% endfor %}
      {% if found_character %}
        <a href="{{ found_character.url }}" class="character-item">
          <div class="character-image" style="background-image: url('{{ found_character.image | default: 'https://via.placeholder.com/420' }}');"></div>
          <div class="character-name">{{ found_character.title }}</div>
        </a>
      {% endif %}
    {% endfor %}
    {% assign unranked = site.characters | sort: "title" %}
    {% for char in unranked %}
      {% assign slug = char.title | slugify %}
      {% unless rankedSlugs contains slug %}
        <a href="{{ char.url }}" class="character-item">
          <div class="character-image" style="background-image: url('{{ char.image | default: 'https://via.placeholder.com/420' }}');"></div>
          <div class="character-name">{{ char.title }}</div>
        </a>
      {% endunless %}
    {% endfor %}
  </div>

  <!-- Alphabetical View -->
  <div id="alphabetical-container" class="character-view-container" style="display: none;">
    {% assign alpha_chars = site.characters | sort: "title" %}
    {% for char in alpha_chars %}
      <a href="{{ char.url }}" class="character-item">
        <div class="character-image" style="background-image: url('{{ char.image | default: 'https://via.placeholder.com/420' }}');"></div>
        <div class="character-name">{{ char.title }}</div>
      </a>
    {% endfor %}
  </div>

  <!-- Sorted (Grouped) View -->
  <div id="sorted-container" class="character-view-container" style="display: none;">
    {% for category in site.data.character_categories %}
      <div class="character-category-card" data-slug="{{ category.slug }}" style="cursor: pointer; display: inline-block; margin: 10px; text-decoration: none; color: inherit;">
        <div class="category-image" style="background-image: url('{{ category.image | default: 'https://via.placeholder.com/420' }}'); width: 200px; height: 200px; background-size: cover; border: 2px solid #ddd; border-radius: 5px;"></div>
        <div class="category-name" style="text-align: center; margin-top: 5px; font-size: 1.2rem;">{{ category.name }}</div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){
  var popTab = document.getElementById("popularity-tab");
  var alphaTab = document.getElementById("alphabetical-tab");
  var sortedTab = document.getElementById("sorted-tab");

  var popContainer = document.getElementById("popularity-container");
  var alphaContainer = document.getElementById("alphabetical-container");
  var sortedContainer = document.getElementById("sorted-container");

  function clearActive() {
    document.querySelectorAll(".sort-tab").forEach(function(tab) {
      tab.classList.remove("active");
    });
  }

  popTab.addEventListener("click", function(){
    clearActive();
    popTab.classList.add("active");
    popContainer.style.display = "grid";
    alphaContainer.style.display = "none";
    sortedContainer.style.display = "none";
    // Reset sorted container to original category cards view
    sortedContainer.innerHTML = window.originalSortedHTML;
  });

  alphaTab.addEventListener("click", function(){
    clearActive();
    alphaTab.classList.add("active");
    popContainer.style.display = "none";
    alphaContainer.style.display = "grid";
    sortedContainer.style.display = "none";
    sortedContainer.innerHTML = window.originalSortedHTML;
  });

  sortedTab.addEventListener("click", function(){
    clearActive();
    sortedTab.classList.add("active");
    popContainer.style.display = "none";
    alphaContainer.style.display = "none";
    sortedContainer.style.display = "grid";
    // Save original sorted HTML if not already saved
    if(!window.originalSortedHTML) {
      window.originalSortedHTML = sortedContainer.innerHTML;
    } else {
      sortedContainer.innerHTML = window.originalSortedHTML;
    }
  });

  // Attach click events to category cards in Sorted view
  function attachCategoryListeners() {
    var cards = sortedContainer.querySelectorAll(".character-category-card");
    cards.forEach(function(card) {
      card.addEventListener("click", function(e) {
        e.preventDefault();
        var catSlug = card.getAttribute("data-slug");
        loadCategory(catSlug);
      });
    });
  }
  
  attachCategoryListeners(); // initial attachment

  // Data injection from Jekyll as JSON
  var categoryData = {{ site.data.character_categories | jsonify }};
  var allCharacters = {{ site.characters | jsonify }};

  function slugify(text) {
    return text.toString().toLowerCase().trim().replace(/\s+/g, '-');
  }

  function findCharacterBySlug(slug) {
    for (var i = 0; i < allCharacters.length; i++) {
      var char = allCharacters[i];
      if (slugify(char.title) === slug) {
        return char;
      }
    }
    return null;
  }

  function loadCategory(categorySlug) {
    var cat = null;
    for (var i = 0; i < categoryData.length; i++) {
      if (categoryData[i].slug === categorySlug) {
        cat = categoryData[i];
        break;
      }
    }
    if (!cat) return;
    var html = "";
    if (cat.characters && cat.characters.length > 0) {
      for (var j = 0; j < cat.characters.length; j++) {
        var slug = cat.characters[j];
        var character = findCharacterBySlug(slug);
        if (character) {
          html += '<a href="' + character.url + '" class="character-item">';
          html += '<div class="character-image" style="background-image: url(\'' + (character.image || "https://via.placeholder.com/420") + '\');"></div>';
          html += '<div class="character-name">' + character.title + '</div>';
          html += '</a>';
        }
      }
    }
    sortedContainer.innerHTML = html;
    // Reapply grid styling by reattaching the same container class (if needed)
    sortedContainer.className = "character-view-container";
  }
});
</script>
